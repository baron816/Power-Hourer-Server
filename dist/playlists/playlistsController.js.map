{"version":3,"sources":["../../src/playlists/playlistsController.js"],"names":["playlistsIndex","playlistsCreate","playlistItems","playlistDelete","playlistIncrementPlayCount","playlistItemUpdate","moveItemUpdate","playlistUpdate","idParam","playlistItemParam","req","res","next","page","query","paginate","exposed","sort","limit","then","docs","pages","total","playlists","map","_id","owner","playlistId","thumbnail","title","playCount","json","err","newPlaylist","body","save","playlist","remove","removed","item","playlistItem","update","Object","assign","oldIndex","newIndex","movePlaylistItem","id","findById","Error","itemId","find","String"],"mappings":"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","file":"playlistsController.js","sourcesContent":["import Playlist from './playlistModel';\n\nexport function playlistsIndex(req, res, next) {\n  const {page} = req.query;\n\n  Playlist\n  .paginate({exposed: true}, {sort: '-playCount', limit: 25, page: page || 1})\n  .then(function({docs, page, pages, total}) {\n    const playlists = docs.map(({_id, owner, playlistId, thumbnail, title, playCount}) => ({_id, owner, playlistId, thumbnail, title, playCount}));\n    res.json({playlists, page, pages, total});\n  }, function(err) {\n    next(err);\n  });\n}\n\nexport function playlistsCreate(req, res, next) {\n  const newPlaylist = new Playlist(req.body);\n\n  newPlaylist.save(function(err, playlist) {\n    if (err) {\n      next(err);\n    }\n\n    res.json({playlist});\n  });\n}\n\nexport function playlistItems(req, res) {\n  const {playlistItems} = req.playlist;\n\n  res.json(playlistItems || []);\n}\n\nexport function playlistDelete(req, res, next) {\n  const playlist = req.playlist;\n\n  playlist.remove(function (err, removed) {\n    if (err) {\n      next(err);\n    } else {\n      res.json(removed);\n    }\n  });\n}\n\nexport function playlistIncrementPlayCount(req, res, next) {\n  const playlist = req.playlist;\n\n  playlist.playCount += 1;\n\n  playlist.save(function (err) {\n    if (err) {\n      next(err);\n    } else {\n      res.json(playlist._id);\n    }\n  });\n}\n\nexport function playlistItemUpdate(req, res, next) {\n  const playlist = req.playlist;\n  var item = req.playlistItem;\n  const update = req.body;\n\n  req.playlistItem = Object.assign(item, update);\n\n  playlist.save(function(err) {\n    if (err) {\n      next(err);\n    } else {\n      res.json(req.playlistItem);\n    }\n  });\n}\n\nexport function moveItemUpdate(req, res) {\n  const playlist = req.playlist;\n  const {oldIndex, newIndex} = req.body;\n\n  playlist.movePlaylistItem(oldIndex, newIndex);\n\n  res.json(playlist._id || {});\n}\n\nexport function playlistUpdate(req, res, next) {\n  const playlist = req.playlist;\n  const update = req.body;\n\n  req.playlist = Object.assign(playlist, update);\n\n  req.playlist.save(function (err, playlist) {\n    if (err) {\n      next(err);\n    } else {\n      const { _id, exposed, thumbnail, playlistId, owner, title } = playlist;\n      res.json({ _id, exposed, thumbnail, playlistId, owner, title } || {});\n    }\n  });\n}\n\nexport function idParam(req, res, next, id) {\n  Playlist\n  .findById(id)\n  .then(function(playlist) {\n    if (playlist) {\n      req.playlist = playlist;\n      next();\n    } else {\n      next(new Error('Not found'));\n    }\n  }, function(err) {\n    next(err);\n  });\n}\n\nexport function playlistItemParam(req, res, next, itemId) {\n  const playlist = req.playlist;\n  const playlistItem = playlist.playlistItems.find((item) => String(item._id) === itemId);\n\n  req.playlistItem = playlistItem;\n  next();\n}\n"]}