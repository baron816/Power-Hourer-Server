{"version":3,"sources":["../../src/playlists/playlistsController.js"],"names":["playlistsIndex","playlistsCreate","playlistItems","playlistDelete","playlistIncrementPlayCount","playlistItemUpdate","moveItemUpdate","playlistUpdate","idParam","playlistItemParam","req","res","next","page","query","paginate","exposed","sort","limit","then","docs","pages","total","playlists","map","_id","owner","playlistId","thumbnail","title","playCount","json","err","body","user","newPlaylist","save","playlist","remove","removed","item","playlistItem","update","Object","assign","oldIndex","newIndex","movePlaylistItem","id","findById","Error","itemId","find","String"],"mappings":"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","file":"playlistsController.js","sourcesContent":["import Playlist from './playlistModel';\n\nexport function playlistsIndex(req, res, next) {\n  const {page} = req.query;\n\n  Playlist\n  .paginate({exposed: true}, {sort: '-playCount', limit: 25, page: page || 1})\n  .then(function({docs, page, pages, total}) {\n    const playlists = docs.map(({_id, owner, playlistId, thumbnail, title, playCount}) => ({_id, owner, playlistId, thumbnail, title, playCount}));\n    res.json({playlists, page, pages, total});\n  }, function(err) {\n    next(err);\n  });\n}\n\nexport function playlistsCreate(req, res, next) {\n  req.body.owner = req.user._id;\n\n  const newPlaylist = new Playlist(req.body);\n\n  newPlaylist.save(function(err, playlist) {\n    if (err) {\n      next(err);\n    }\n\n    res.json({playlist});\n  });\n}\n\nexport function playlistItems(req, res) {\n  const {playlistItems} = req.playlist;\n\n  res.json(playlistItems || []);\n}\n\nexport function playlistDelete(req, res, next) {\n  const playlist = req.playlist;\n\n  playlist.remove(function (err, removed) {\n    if (err) {\n      next(err);\n    } else {\n      res.json(removed);\n    }\n  });\n}\n\nexport function playlistIncrementPlayCount(req, res, next) {\n  const playlist = req.playlist;\n\n  playlist.playCount += 1;\n\n  playlist.save(function (err) {\n    if (err) {\n      next(err);\n    } else {\n      res.json(playlist._id);\n    }\n  });\n}\n\nexport function playlistItemUpdate(req, res, next) {\n  const playlist = req.playlist;\n  const item = req.playlistItem;\n  const update = req.body;\n\n  req.playlistItem = Object.assign(item, update);\n\n  playlist.save(function(err) {\n    if (err) {\n      next(err);\n    } else {\n      res.json(req.playlistItem);\n    }\n  });\n}\n\nexport function moveItemUpdate(req, res) {\n  const playlist = req.playlist;\n\n  const {oldIndex, newIndex} = req.body;\n\n  playlist.movePlaylistItem(oldIndex, newIndex);\n\n  res.json(playlist._id || {});\n}\n\nexport function playlistUpdate(req, res, next) {\n  const playlist = req.playlist;\n  const update = req.body;\n\n  req.playlist = Object.assign(playlist, update);\n\n  req.playlist.save(function (err, playlist) {\n    if (err) {\n      next(err);\n    } else {\n      const { _id, exposed, thumbnail, playlistId, owner, title } = playlist;\n      res.json({ _id, exposed, thumbnail, playlistId, owner, title } || {});\n    }\n  });\n}\n\nexport function idParam(req, res, next, id) {\n  Playlist\n  .findById(id)\n  .then(function(playlist) {\n    if (playlist) {\n      req.playlist = playlist;\n      next();\n    } else {\n      next(new Error('Not found'));\n    }\n  }, function(err) {\n    next(err);\n  });\n}\n\nexport function playlistItemParam(req, res, next, itemId) {\n  const playlist = req.playlist;\n  const playlistItem = playlist.playlistItems.find((item) => String(item._id) === itemId);\n\n  req.playlistItem = playlistItem;\n  next();\n}\n"]}